# Circom Simple Very Base Without Deep Dive Workshop


## Installation

```
npm install -g circom
npm install -g snarkjs
```

## Compile

```
circom quadratic.circom --r1cs --wasm --sym --c
```

## Trusted Setup

### Phase 1

Фаза 1 предназначена для создания общих параметров, которые используются всеми схемами. Она обеспечивает, что все последующие схемы, построенные на этих параметрах, могут быть безопасно проверены.
Фаза 1 генерирует последовательность степеней числа (τ), известную как **Powers of Tau**. Они нужны для криптографических вычислений дальше. 

#### Что такое Tau?
Tau (τ) в данном контексте – это случайное число, выбранное во время церемонии настройки. Оно используется для генерации публичных параметров, необходимых для создания и проверки zk-SNARK доказательств. Это число должно быть известно только в самом начале процесса, но его истинное значение не должно быть раскрыто после завершения церемонии, чтобы обеспечить безопасность системы.

Процесс церемонии Powers of Tau

- Инициализация

Первый участник выбирает случайное число τ и генерирует последовательность его степеней.
Генерируются файлы с этими степенями, которые передаются следующему участнику.

- Вклад участников

Каждый последующий участник выбирает свое случайное число, умножает все степени τ на это число, и передает полученные степени следующему участнику.
Этот процесс продолжается, пока все участники не внесут свои вклады.

- Конечный результат

Последний файл с последовательностями степеней τ содержит все вклады участников. Этот файл используется для создания публичных параметров для zk-SNARK.

```
snarkjs powersoftau new bn128 12 pot12_0000.ptau -v
```

- Инициализация новой церемонии Powers of Tau (Powers of Tau - это подготовительная фаза для ZK-Snark). bn128 - это кривая Баррето-Нейи (Barreto-Naehrig), 12 - степень 2^12, pot12_0000.ptau - выходной файл.

```
snarkjs powersoftau contribute pot12_0000.ptau pot12_0001.ptau --name="First contribution" -v`
```

- Внесение в церемонию Powers of Tau, переход от pot12_0000.ptau к pot12_0001.ptau. --name - опция для имени вкладчика.

### Phase 2

Фаза 2 предназначена для создания параметров, специфичных для конкретной схемы. Она настраивает параметры, необходимые для генерации и проверки доказательств в контексте определенной вычислительной задачи.
Фаза 2 использует общие параметры, созданные на фазе 1, и добавляет дополнительные специфичные для схемы параметры.
В результате получается файл с ключами, который будет использоваться для генерации и проверки доказательств для данной схемы.

Процесс

- Использование R1CS файла

Фаза 2 начинается с использования файла R1CS (Rank-1 Constraint System), который описывает схему в виде системы ограничений. Этот файл был создан при компиляции схемы на языке Circom.

- Создание параметров для схемы

Фаза 2 создает параметры, специфичные для данной схемы, используя общие параметры, созданные на фазе 1. Эти параметры включают в себя информацию о системе ограничений, входных и выходных данных, а также промежуточных вычислениях.

- Внесение вклада

Как и в фазе 1, фаза 2 может включать множество участников, каждый из которых вносит свой вклад в параметры схемы. Это делает процесс настройки более безопасным, так как конечные параметры будут надежны даже при наличии честного участника.-    
- Экспорт верификационного ключа

После завершения настройки параметров схемы, создается верификационный ключ, который будет использоваться для проверки доказательств.

```
snarkjs powersoftau prepare phase2 pot12_0001.ptau pot12_final.ptau -v
```

- Подготовка файла Powers of Tau для второй фазы. pot12_0001.ptau - входной файл, pot12_final.ptau - выходной файл.

```
snarkjs groth16 setup quadratic.r1cs pot12_final.ptau quadratic_0000.zkey
```

- Настройка параметров Groth16 для схемы. quadratic.r1cs - файл с ограничениями, pot12_final.ptau - файл Powers of Tau, quadratic_0000.zkey - выходной файл с ключами.

```
snarkjs zkey contribute quadratic_0000.zkey quadratic_0001.zkey --name="1st Contributor Name" -v
```

- Внесение в файл ключей. quadratic_0000.zkey - входной файл, quadratic_final.zkey - выходной файл, --name - имя контрибьютора.

```
snarkjs zkey export verificationkey quadratic_0001.zkey verification_key.json
```

- verification_key.json выходной файл, который будет содержать верификационный ключ. Этот ключ используется для проверки доказательств.


## Generation Proof

### Generation Witness

- Ввод данных

Пользователь предоставляет входные данные для схемы.
Вычисление свидетельства:

- На основе входных данных и схемы вычисляется witness, который включает в себя

Входные данные (input signals).
Промежуточные значения (internal signals), необходимые для выполнения вычислений.
Выходные значения (output signals), полученные в результате вычислений.

- Формат Witness

Witness сохраняется в специальном формате, который может быть использован для дальнейшей генерации доказательства. В Circom и SnarkJS witness сохраняется в файле с расширением .wtns.

```
node quadratic_js/generate_witness.js quadratic_js/quadratic.wasm input.json witness.wtns
```

- Генерация свидетельства с использованием WebAssembly файла. quadratic_js/quadratic.wasm - WebAssembly файл, input.json - входной файл с данными, witness.wtns - выходной файл со свидетельством.


### Генерация доказательства использует witness

Чтобы доказать корректность вычислений, не раскрывая сами значения. Этот процесс включает использование криптографических алгоритмов для создания пруфа на основе witness.

```
snarkjs groth16 prove quadratic_0001.zkey witness.wtns proof.json public.json
```

- Генерация пруфа. quadratic_final.zkey - файл с ключами, witness.wtns - файл со свидетельством, proof.json - выходной файл с пруфом, public.json - выходной файл с публичными данными.

## Verification proof 

Проверка пруфа не требует полного знания witness. Вместо этого используется верификационный ключ и публичные данные для проверки корректности пруфа.

```
snarkjs groth16 verify verification_key.json public.json proof.json
```
